# Feature-management focused: config vars (money, discount, productSummary, image, promoBanner) + inline toggles/rollout.
feature: withComplexSchema
assertions:
  # --- Staging: control – thresholds, promos, spotlight product, banner, toggles, rollout ---
  - at: 25
    environment: staging
    expectedToBeEnabled: true
    expectedVariation: control
    expectedVariables:
      storeName: "Control Store"
      freeShippingThreshold:
        amount: 50.0
        currency: USD
      trialCredit:
        amount: 0
        currency: USD
      appliedDiscount:
        code: "SAVE5"
        type: "fixed"
        value: 5.0
      featuredProduct:
        id: "prod-1"
        name: "Control Featured"
        sku: "CF-001"
        price:
          amount: 24.99
          currency: USD
      heroImage:
        url: "https://example.com/hero.jpg"
        alt: "Hero"
      promoBanner:
        message: "Save $5 on your first order"
        cta:
          title: "Claim offer"
          url: /promo/save5
      enableReviews: true
      maxCartSize: 10
      defaultCurrency: "USD"
      checkoutConfig:
        allowGuestCheckout: true
        requirePhone: false
      allowedCountries:
        - US
        - CA
        - GB
      bannerMessage: "Free shipping on orders over $50"

  # --- Staging: treatment – different thresholds, trial credit, promo, banner ---
  - at: 75
    environment: staging
    expectedToBeEnabled: true
    expectedVariation: treatment
    expectedVariables:
      storeName: "Treatment Store"
      freeShippingThreshold:
        amount: 75.0
        currency: USD
      trialCredit:
        amount: 10.0
        currency: USD
      featuredProduct:
        id: "prod-1"
        name: "Treatment Featured"
        sku: "TF-001"
        price:
          amount: 22.99
          currency: USD
      appliedDiscount:
        code: "SAVE10"
        type: "percentage"
        value: 10.0
      promoBanner:
        message: "10% off – limited time"
        cta:
          title: "Get 10% off"
          url: /promo/save10
      enableReviews: true
      checkoutConfig:
        allowGuestCheckout: false
        requirePhone: true
      heroImage:
        url: "https://example.com/hero.jpg"
        alt: "Hero"
      maxCartSize: 10
      defaultCurrency: "USD"
      allowedCountries:
        - US
        - CA
        - GB
      bannerMessage: "Free shipping on orders over $50"

  # --- Production: control ---
  - at: 25
    environment: production
    expectedToBeEnabled: true
    expectedVariation: control
    expectedVariables:
      storeName: "Control Store"
      freeShippingThreshold:
        amount: 50.0
        currency: USD
      trialCredit:
        amount: 0
        currency: USD
      appliedDiscount:
        code: "SAVE5"
        type: "fixed"
        value: 5.0
      featuredProduct:
        id: "prod-1"
        name: "Control Featured"
        sku: "CF-001"
        price:
          amount: 24.99
          currency: USD

  # --- Production: treatment ---
  - at: 75
    environment: production
    expectedToBeEnabled: true
    expectedVariation: treatment
    expectedVariables:
      storeName: "Treatment Store"
      freeShippingThreshold:
        amount: 75.0
        currency: USD
      trialCredit:
        amount: 10.0
        currency: USD
      appliedDiscount:
        code: "SAVE10"
        type: "percentage"
        value: 10.0
      checkoutConfig:
        allowGuestCheckout: false
        requirePhone: true

  # --- Nested refs: productSummary.price (money), promoBanner.cta (link) ---
  - at: 15
    environment: staging
    expectedToBeEnabled: true
    expectedVariation: control
    expectedVariables:
      featuredProduct:
        id: "prod-1"
        name: "Control Featured"
        sku: "CF-001"
        price:
          amount: 24.99
          currency: USD
      freeShippingThreshold:
        amount: 50.0
        currency: USD
      promoBanner:
        message: "Save $5 on your first order"
        cta:
          title: "Claim offer"
          url: /promo/save5
